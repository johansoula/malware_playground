#!/usr/bin/env python

import re
import requests
import sys
import os

from datetime import date, timedelta

def virusign_yday(fname):
    url = "http://virusign.com/hashlists/%s.csv" % (date.today() - timedelta(days=1)).strftime('%Y-%m-%d')

    r = requests.get(url, stream = True)
    if r.status_code != 200:
        return False

    with open(fname, 'aw') as fd:                      
        chunk_size  = 8192                         
        for chunk in r.iter_content(chunk_size):
            fd.write(chunk)
        fd.close
    return True


def virusign_prev_month(fname, month, year):
    url = "http://virusign.com/hashlists/%s-%s.csv" % (year, month)

    r = requests.get(url, stream = True)
    if r.status_code != 200:
        return False

    with open(fname, 'aw') as fd:                      
        chunk_size  = 8192                         
        for chunk in r.iter_content(chunk_size):
            fd.write(chunk)
        fd.close
    return True


def virusign_day(fname, day, month, year):
    url = "http://virusign.com/hashlists/%s-%s-%s.csv" % (year, month, day)

    r = requests.get(url, stream = True)
    if r.status_code != 200:
        return False

    with open(fname, 'aw') as fd:                      
        chunk_size  = 8192                         
        for chunk in r.iter_content(chunk_size):
            fd.write(chunk)
        fd.close
    return True


def virusign_fetch_cur_month(fname, month, year):
    for i in range(1, 31):
        day = "%02d" % i
        virusign_day(fname, day, month, year)


def virusign_fetch_all(fname):
    for y in [ "2013", "2014", "2015" ]:
        for m in [ "01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"]:
            virusign_prev_month(fname, m, y)


#virusign_fetch_all("virusign_hashlist.csv")
#virusign_fetch_cur_month("virusign_hashlist.csv", "08", "2015")

virusign_yday("virusign_hashlist.csv")

